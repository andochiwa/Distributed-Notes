# Zookeeper 入门

## 1. 概述

Zookeeper 是一个开源的分布式的，为分布式框架提供协调服务的 Apache 项目

## 2. 特点

1. 一个 Leader，多个 Follower 组成的集群
2. 集群中只要有半数以上节点存活，Zookeeper 集群就能正常服务。所以 Zookeeper 适合**奇数台服务器**
3. 全局数据一致：每个 Server 保存一份相同的数据副本，Client 无论连接到哪个 Server，数据都是一致的
4. 更新请求顺序执行，来自同一个 Client 的更新请求按其发送顺序执行
5. 数据更新的原子性，实时性（一定时间范围内，Client一定能读到最新数据）

## 3. 数据结构

Zookeeper 数据模型的结构与 Unix 文件系统很类似，整体上可以看做是一颗树，每个节点称做一个`ZNode`，每一个 ZNode 默认能够存储 1MB 的数据，每个 ZNode 都可以通过其路径唯一标识

<img src="img/1.png" style="zoom:150%;" />

## 4. 应用场景

提供的服务包括：统一命名服务、统一配置服务、统一集群管理、服务节点动态上下线、软负载均衡等

### 4.1 统一命名服务

在分布式环境下，经常需要对应用/服务进行统一命名，以便于识别。

与nacos对服务命名类似，都是为了容易识别。

### 4.2 统一配置服务

分布式环境下，配置文件同步非常的常见。一般要求一个集群中，所有节点的配置信息是一致的，比如 Kafka 集群。对配置文件修改后，希望能快速同步到各个节点上。

配置管理可以交给 Zookeeper 来实现，可以将配置信息写入 Zookeeper 的 ZNode 上，客户端服务器都去监听这个 ZNode，一旦 ZNode 中的数据被修改，Zookeeper 将通知各个客户端服务器

### 4.3 统一集群管理

分布式环境中，实时掌握每个节点的状态是必要的。可以根据节点的实时状态做出一些调整。

Zookeeper 可以实现监控节点状态变化，可以将节点信息写入到 Zookeeper 的一个 ZNode 上，监听这个 ZNode 即可获取它的实时状态变化

### 4.4 服务动态上下线

客户端以及服务之间可以实时洞察到服务的的上下线

### 4.5 软负载均衡

在 Zookeeper 中记录每台服务器的访问数，可以让访问数最少的服务去处理最新的客户端请求

# Zookeeper 安装

## 1. 本地、集群安装

用 docker-compose，又快又方便~

```bash
docker-compose up -d
```

## 2. 配置文件参数

LF：Leader and Follower

```bash
tickTime=2000   # Zookeeper服务器与客户端的通信心跳时间，单位毫秒
initLimit=10    # LF初始通信时限
syncLimit=5     # LF同步通信时限
dataDir:        # 保存Zookeeper中的数据
clientPort=2181 # 客户端连接端口，通常不做修改
```

